import{j as t,Q as T,a as D}from"./@tanstack/react-query-0fc54b05.js";import{a as L,r as d}from"./vendor-ba4585ac.js";import{u as p,a as x,P as k}from"./react-redux-3eebec38.js";import{o as O}from"./mobx-react-lite-8a735211.js";import{R as G}from"./react-paginate-7dab44e3.js";import{c as I,a as H,b as $}from"./redux-b3f984f5.js";import{t as K}from"./redux-thunk-ef899f4c.js";import{u as z,f as y,g as F,a as B,b as U}from"./@tanstack/react-table-779ffba6.js";import{S as q}from"./react-loading-skeleton-f506fc4e.js";import{h as Q}from"./moment-a9aaa855.js";import{a as j}from"./axios-9cbf0d09.js";import{M as J}from"./react-bootstrap-96edd355.js";import"./mobx-2e7761d7.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function c(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=c(r);fetch(r.href,o)}})();var g={},b=L;g.createRoot=b.createRoot,g.hydrateRoot=b.hydrateRoot;const V=({handlePageClick:e})=>{const{pageCount:s,currentPage:c}=p(a=>a.baseReducer);return t.jsx(G,{pageCount:s,marginPagesDisplayed:2,pageRangeDisplayed:5,forcePage:c,onPageChange:e,previousLabel:"<",nextLabel:">",containerClassName:"table-pagination",activeClassName:"active"})},_="CHANGE_PAGE_COUNT",N="CHANGE_CURRENT_PAGE",A="CHANGE_SEARCH",W={pageCount:0,currentPage:0,searchTable:""},X=(e=W,s)=>{switch(s.type){case _:return{...e,pageCount:s.payload};case N:return{...e,currentPage:s.payload};case A:return{...e,searchTable:s.payload};default:return e}},C=e=>({type:_,payload:e}),S=e=>({type:N,payload:e}),Y=e=>({type:A,payload:e}),R="GET_LIST",v="ADD_ITEM",w="GET_DETAIL",Z={tableList:[],detail:{}},ee=(e=Z,s)=>{switch(s.type){case R:return{...e,tableList:s.payload};case v:return{...e,tableList:[s.payload,...e.tableList]};case w:return{...e,detail:s.payload};default:return e}},te=e=>({type:R,payload:e}),se=e=>({type:v,payload:e}),ae=e=>({type:w,payload:e}),E="OPEN_MODAL",P="CHANGE_NAME_MODAL",re={id:"",name_modal:""},ce=(e=re,s)=>{switch(s.type){case E:return{...e,id:s.payload};case P:return{...e,name_modal:s.payload};default:return e}},oe=e=>({type:E,payload:e}),f=e=>({type:P,payload:e}),ne=I({baseReducer:X,modalReducer:ce,tableReducer:ee}),m=H(ne,$(K));class ie{dispatch(s){m.dispatch(s)}refreshTableData(){this.dispatch(S(0)),this.dispatch(C(0)),this.dispatch(Y(""))}}const le=new ie,de=()=>t.jsx("tr",{className:"text-center",children:t.jsx("td",{colSpan:5,children:"Данных нет в таблице...."})}),ue=({col:e})=>t.jsx(t.Fragment,{children:Array(5).fill({}).map((s,c)=>t.jsx("tr",{children:Array(e).fill({}).map((a,r)=>t.jsx("td",{children:t.jsx(q,{height:20})},r))},c))}),pe=e=>new DOMParser().parseFromString(e,"text/html").documentElement.textContent,me=({fetchData:e})=>{const s=x(),[c,a]=d.useState([]),{tableList:r}=p(i=>i.tableReducer);function o(i){s(oe(i)),s(f("detail"))}const l=[{accessorKey:"received_date",header:"Received",cell:({cell:i,row:n})=>Q(n.original.received_date).format("h:m A")},{accessorKey:"pick_up_at",header:"Pick-up At"},{accessorKey:"deliver_to",header:"Delivery"},{accessorKey:"suggested_truck",header:"Vehicle",size:300},{accessorKey:"miles",header:"Miles"},{accessorKey:"match",header:"Match"},{accessorKey:"contact_name",header:"Brokerage",size:100,cell:({cell:i,row:n})=>t.jsxs("span",{children:["(",n.original.source_name.substring(0,1),") ",pe(n.original.contact_name)]})}],h=z({columns:l,data:r,getCoreRowModel:F(),getSortedRowModel:B(),getFilteredRowModel:U(),state:{sorting:c},defaultColumn:{minSize:230},onSortingChange:a});return t.jsx("div",{className:"table-container",children:t.jsxs("table",{className:"table-style",children:[t.jsx("thead",{children:h.getHeaderGroups().map(i=>t.jsx("tr",{children:i.headers.map(n=>t.jsxs("th",{onClick:n.column.getToggleSortingHandler(),children:[y(n.column.columnDef.header,n.getContext()),{asc:t.jsx("i",{className:"ml-2 fa fa-sort-up"}),desc:t.jsx("i",{className:"ml-2 fa fa-sort-down"})}[n.column.getIsSorted()??null]]},n.id))},i.id))}),t.jsxs("tbody",{children:[h.getRowModel().rows.length>0&&e===1&&h.getRowModel().rows.map(i=>t.jsx("tr",{className:"cu-p",id:`row${i.original.id}`,onClick:()=>o(i.original.id),children:i.getVisibleCells().map(n=>t.jsx("td",{children:y(n.column.columnDef.cell,n.getContext())},n.id))},i.id)),e===0&&t.jsx(ue,{col:l.length}),e===2&&t.jsx(de,{})]})]})})},M=()=>"https://parser-tms.altek.uz",he=()=>"wss://websocket-tms.altek.uz",ge=(e=1)=>`${M()}/api/lol/list/?page=${e}`,fe=e=>`${M()}/api/lol/${e}/`,xe=(e=1)=>`${he()}/api/v1/lol/ws/${e}`;class ye{dispatch(s){m.dispatch(s)}async getList(s){const c=m.getState().baseReducer.currentPage+1,{data:a}=await j.get(ge(c));a.results.length>0&&s(1),a.results.length===0&&s(2),this.dispatch(te(a.results)),this.dispatch(C(Math.ceil(a.count/25)))}async getDetail(s){const{data:c}=await j.get(fe(s));this.dispatch(ae(c))}async getNewItem(s){s.onmessage=async c=>{const a=JSON.parse(c.data),r=JSON.parse(a);this.dispatch(se(r)),setTimeout(()=>{const o=document.getElementById(`row${r.id}`);o.addEventListener("animationend",l=>{o.className="cu-p"}),o.className="cu-p flash"},50)}}}const u=new ye,je=()=>{const e=x(),{id:s,name_modal:c}=p(r=>r.modalReducer),{detail:a}=p(r=>r.tableReducer);return d.useEffect(()=>{c==="detail"&&u.getDetail(s)},[c]),t.jsx(J,{size:"xl",show:c==="detail",onHide:()=>e(f("")),centered:!0,children:t.jsxs("div",{className:"p-3",children:[t.jsx("div",{className:"border-bottom-modal",children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[t.jsx("h5",{className:"modal-title",children:"Detail"}),t.jsx("button",{type:"button",className:"close",onClick:()=>e(f("")),children:t.jsx("span",{className:"material-icons",children:"close"})})]})}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Pick-up at:"})," ",a==null?void 0:a.pick_up_at]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Pick-up date:"})," ",a==null?void 0:a.pick_up_date]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Deliver to:"})," ",a==null?void 0:a.deliver_to]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Delivery date:"})," ",a==null?void 0:a.delivery_date]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Miles:"})," ",a==null?void 0:a.miles]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Suggested Truck Size:"})," ",a==null?void 0:a.suggested_truck]})]})]})})},be=()=>{const e=x(),[s,c]=d.useState(0),[a,r]=d.useState({}),o=l=>{e(S(l.selected)),u.getList(c)};return d.useEffect(()=>(u.getList(c),r(new WebSocket(xe())),()=>{le.refreshTableData()}),[]),d.useEffect(()=>{u.getNewItem(a)},[a]),t.jsxs("div",{className:"page-container",children:[t.jsxs("div",{className:"table-wrapper not-btn",children:[t.jsx("div",{className:"d-flex align-items-center justify-content-between mb-2",children:t.jsx("h3",{children:"Dispatch"})}),t.jsx(me,{fetchData:s}),t.jsx(V,{handlePageClick:o})]}),t.jsx(je,{})]})},_e=O(()=>t.jsx(be,{}));const Ne=new T({defaultOptions:{queries:{refetchOnWindowFocus:!1}}}),Ae=g.createRoot(document.getElementById("root"));Ae.render(t.jsx(D,{client:Ne,children:t.jsx(k,{store:m,children:t.jsx(_e,{})})}));
